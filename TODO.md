# ELUO 프로젝트 - 사전 분석 시스템 완전 재구축

## 🎯 프로젝트 목표
질문 생성 완료 후 자동 이동 문제를 근본적으로 해결하기 위해 사전 분석 시스템을 완전히 재구축합니다.

## 📋 작업 계획

### Phase 1: 기본 구조 설계 ✅
- [x] 기존 사전 분석 컴포넌트 백업 (`backup/preAnalysis/`)
- [x] 기존 컴포넌트 삭제 완료
- [x] TODO.md 백업 및 새로 생성
- [x] 새로운 아키텍처 설계

### Phase 2: 핵심 컴포넌트 구현 ✅
- [x] **PreAnalysisPage.tsx** - 메인 페이지 컴포넌트
  - 단계별 진행 관리 (setup → analysis → questions → report)
  - 명확한 상태 관리 (단일 진실 공급원)
  - 단계 간 자동 이동 로직

- [x] **PreAnalysisPanel.tsx** - 메인 패널 컴포넌트
  - 분석 세션 관리
  - 단계별 진행 표시
  - 상태 추적 및 제어

- [x] **AIModelSelector.tsx** - AI 모델 선택 컴포넌트
  - 다중 제공업체 지원 (OpenAI, Anthropic, Google)
  - 분석 깊이 설정
  - 비용 및 성능 정보 표시

- [x] **MCPConfiguration.tsx** - MCP 서버 설정 컴포넌트
  - 서버별 활성화/비활성화
  - 연결 상태 모니터링
  - 설정 관리 UI

- [x] **AnalysisProgress.tsx** - 진행 상황 추적 컴포넌트
  - 실시간 진행률 모니터링
  - 단계별 완료 상태 관리
  - 자동 이동 트리거

- [x] **QuestionAnswer.tsx** - 질문 답변 컴포넌트
  - 질문 생성 프로세스 관리
  - 답변 입력 및 저장
  - 진행률 추적

- [x] **AnalysisReport.tsx** - 분석 보고서 컴포넌트
  - 종합 분석 결과 표시
  - 다양한 형태 내보내기
  - 시각적 데이터 표현

### Phase 3: 상태 관리 시스템 (계획중)
- [ ] **usePreAnalysisFlow.ts** - 전체 플로우 관리 훅
  - 단계별 상태 관리
  - 자동 이동 조건 판단
  - 실시간 데이터 동기화

- [ ] **useStepTransition.ts** - 단계 전환 전용 훅
  - 단계 전환 조건 검증
  - 자동/수동 이동 처리
  - 상태 무결성 보장

### Phase 4: 서비스 레이어 정리 (계획중)
- [ ] **PreAnalysisService.ts** 개선
  - API 호출 최적화
  - 상태 동기화 보장
  - 에러 처리 강화

### Phase 5: 테스트 및 검증 (계획중)
- [ ] 단계별 자동 이동 테스트
- [ ] 상태 동기화 검증
- [ ] 에러 상황 처리 확인

## 🔧 핵심 해결 방안

### 1. 단일 진실 공급원 (Single Source of Truth)
- 모든 진행 상태를 하나의 상태 관리자에서 처리
- 중복된 상태 관리 제거
- 실시간 데이터베이스 상태와 UI 상태 동기화

### 2. 명확한 단계 전환 로직
- 각 단계의 완료 조건을 명확히 정의
- 자동 이동 조건과 수동 이동 조건 분리
- 상태 변경 시 즉시 UI 업데이트

### 3. 실시간 모니터링 시스템
- 데이터베이스 변경 사항 실시간 감지
- 진행 상황 변화 즉시 반영
- 자동 이동 트리거 최적화

### 4. 에러 처리 및 복구
- 네트워크 오류 시 재시도 로직
- 상태 불일치 시 자동 복구
- 사용자 피드백 강화

## 📊 현재 문제 분석

### 기존 문제점
1. **진행률 계산 중복**: PreAnalysisPage와 AnalysisProgress에서 각각 계산
2. **상태 동기화 지연**: DB 변경과 UI 업데이트 간 지연
3. **자동 이동 조건 모호**: 완료 조건이 여러 곳에 분산
4. **폴링 방식의 한계**: 실시간성 부족

### 새로운 접근 방식
1. **상태 중앙화**: 모든 상태를 한 곳에서 관리
2. **이벤트 기반 처리**: Supabase Realtime 적극 활용
3. **조건부 자동 이동**: 명확한 조건 하에서만 자동 이동
4. **사용자 제어 강화**: 수동 이동 옵션 항상 제공

## 🚀 구현 우선순위

1. **1순위**: PreAnalysisPage 기본 구조
2. **2순위**: 단계별 진행 추적 시스템
3. **3순위**: 자동 이동 로직 구현
4. **4순위**: 실시간 동기화 시스템
5. **5순위**: 테스트 및 최적화

---

## 📝 개발 노트

### 2025-09-29
- 기존 사전 분석 시스템 백업 완료
- 새로운 TODO.md 생성
- 전체 재구축 계획 수립

### 다음 단계
- PreAnalysisPage.tsx 기본 구조 설계
- 단계별 상태 관리 시스템 구현

---

**목표**: 질문 생성 완료 후 100% 확실한 자동 이동 보장
**방법**: 단순하고 명확한 아키텍처로 재구축
**결과**: 사용자 경험 향상 및 시스템 안정성 확보
# 🔍 ELUO 벡터 검색 시스템 구현 계획

**계획 수립일**: 2025-09-18
**현재 상태**: 계획 단계
**우선순위**: 높음

## 📊 현재 상태 분석

### ✅ 완료된 인프라
- **Supabase vector 확장**: v0.8.0 활성화 완료
- **데이터베이스 구조**: `document_embeddings` 테이블 준비 완료
- **등록된 문서**: 2개 (PDF, DOCX) - 임베딩 처리 대기 중

### ⚠️ 부족한 부분
- 문서 텍스트 추출 → 청킹 → 임베딩 생성 파이프라인 미구현
- 벡터 검색 서비스 및 RAG 시스템 부재

## 🎯 구현 로드맵

### Phase 1: 문서 임베딩 처리 시스템 (🔴 높음)
**예상 기간**: 1-2일

#### 1.1 텍스트 추출 및 전처리 서비스
```typescript
// src/services/embedding/textProcessor.ts
- PDF/DOCX 텍스트 추출 (기존 OCR 서비스 확장)
- 텍스트 청킹 (1000-1500 토큰 단위, 겹침 200토큰)
- 메타데이터 추출 (제목, 섹션, 페이지 번호)
- 의미적 분할 (문단/섹션 기준)
```

#### 1.2 임베딩 생성 서비스
```typescript
// src/services/embedding/embeddingService.ts
- OpenAI text-embedding-3-large API 연동 (3072 차원)
- Google Vertex AI 임베딩 연동 (백업)
- 배치 처리 및 Rate Limiting 적용
- 비용 추적 및 모니터링 통합
```

#### 1.3 벡터 저장 서비스
```typescript
// src/services/embedding/vectorStorage.ts
- document_embeddings 테이블 CRUD 연산
- 벡터 인덱스 최적화 (HNSW 또는 IVFFlat)
- 중복 처리 방지 로직
- 프로젝트별 스코프 관리
```

### Phase 2: 벡터 검색 시스템 (🟡 중간)
**예상 기간**: 1주일

#### 2.1 유사도 검색 서비스
```typescript
// src/services/search/vectorSearch.ts
- 코사인 유사도 기반 검색 (기본)
- 하이브리드 검색 (벡터 + pg_trgm 키워드)
- 프로젝트별, 문서 타입별 필터링
- 검색 결과 랭킹 최적화
- 검색 성능 메트릭 수집
```

#### 2.2 RAG (Retrieval Augmented Generation) 시스템
```typescript
// src/services/ai/ragService.ts
- 질문-문서 매칭 알고리즘
- 컨텍스트 생성 및 최적화
- AI 모델과 통합 (기존 AI 서비스 확장)
- 답변 품질 평가 및 피드백
- 인용 및 참조 추적
```

### Phase 3: 사용자 인터페이스 (🟢 낮음)
**예상 기간**: 2-4주일

#### 3.1 벡터 검색 UI 컴포넌트
```typescript
// src/components/search/
- VectorSearchInput.tsx (검색창 + 필터)
- SearchResults.tsx (결과 표시 + 페이지네이션)
- DocumentChunk.tsx (관련 문서 청크 표시)
- SimilarityScore.tsx (유사도 점수 시각화)
- SearchHistory.tsx (검색 기록 관리)
```

#### 3.2 관리자 대시보드 확장
```typescript
// src/pages/admin/VectorManagement.tsx
- 임베딩 진행 상태 모니터링
- 벡터 인덱스 성능 분석
- 검색 패턴 및 성능 통계
- 임베딩 재생성 도구
```

## 🛠 기술 스택 및 아키텍처

### 벡터 임베딩
- **Primary**: OpenAI `text-embedding-3-large` (3072 차원, $0.00013/1K tokens)
- **Backup**: Google Vertex AI `textembedding-gecko@003` (768 차원)
- **저장소**: Supabase PostgreSQL + pgvector

### 검색 알고리즘
- **기본 검색**: 코사인 유사도 (`<=>` 연산자)
- **인덱스**: HNSW (Hierarchical Navigable Small World)
- **하이브리드**: 벡터 검색 + pg_trgm 전문 검색
- **필터링**: 프로젝트 ID, 문서 타입, 날짜 범위

### 청킹 전략
- **크기**: 1000-1500 토큰 (겹침 200토큰)
- **분할 방식**: 문단/섹션 기준 의미적 분할
- **메타데이터**: 제목, 페이지, 섹션, 문서 타입, 생성일
- **품질 관리**: 최소 길이 100자, 최대 길이 4000자

## 📈 성능 및 비용 예상

### 처리 용량
- **문서 처리**: 월 1,000개 문서 (평균 50페이지)
- **검색 성능**: 초당 100회 검색 처리
- **응답 시간**: 평균 200ms 이하 (벡터 검색)
- **동시 사용자**: 50명 동시 검색 지원

### 예상 비용 (월간 기준)
```
임베딩 생성:
- 1,000개 문서 × 50페이지 × 500토큰 = 25M 토큰
- 25M × $0.00013 = $3,250

검색 비용:
- 월 10,000회 검색 (무료 - 자체 DB)

총 예상 비용: ~$3,300/월
```

### 최적화 전략
- 중복 문서 임베딩 방지 (해시 기반 중복 체크)
- 배치 처리로 API 호출 최적화
- 검색 결과 캐싱 (Redis 또는 메모리)
- 인덱스 정기 최적화

## 🔗 기존 시스템과의 연동

### 기존 AI 분석 시스템과 연동
- **제안서 작성**: 관련 문서 자동 검색 및 참조
- **시장 조사**: 유사 프로젝트 사례 자동 발굴
- **예산 분석**: 과거 유사 프로젝트 비용 데이터 활용
- **질문 생성**: 문서 기반 컨텍스트로 더 정확한 질문 생성

### 프로젝트 워크플로우 강화
- **각 단계별 문서 추천**: 현재 단계에 적합한 문서 자동 제안
- **인사이트 도출**: 벡터 검색으로 숨겨진 패턴 발견
- **보고서 품질 향상**: 자동 인용 및 근거 자료 포함

## 🚀 다음 단계 실행 계획

### 즉시 실행 (1-2일)
1. `embeddingService.ts` 구현 및 OpenAI API 연동
2. 기존 2개 문서에 대한 임베딩 처리 테스트
3. 기본 벡터 검색 API 구현 및 테스트

### 단기 계획 (1주일)
1. 문서 업로드 시 자동 임베딩 처리 파이프라인 구축
2. 프로젝트 상세 페이지에 벡터 검색 기능 통합
3. 검색 성능 최적화 및 인덱스 튜닝

### 중기 계획 (2-4주일)
1. RAG 시스템 구현 및 AI 분석 시스템 통합
2. 고급 검색 필터 및 사용자 인터페이스 개발
3. 관리자 대시보드에 벡터 관리 기능 추가

## 📊 성공 지표

### 정량적 지표
- 문서 임베딩 성공률: 95% 이상
- 검색 응답 시간: 200ms 이하
- 검색 결과 관련성: 80% 이상 (사용자 평가)
- 비용 효율성: 예산 대비 90% 이하

### 정성적 지표
- 사용자 만족도: 4.0/5.0 이상
- AI 분석 정확도 향상: 기존 대비 20% 향상
- 문서 활용도 증가: 30% 이상
- 프로젝트 인사이트 품질 향상

---

이 계획을 통해 ELUO 프로젝트는 완전한 벡터 기반 지능형 문서 검색 및 분석 시스템을 갖추게 됩니다.